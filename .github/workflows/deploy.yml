name: WPMUDEV SSH Deploy
on:
  pull_request:
    branches: [ master ]
  # workflow_dispatch:
  #   inputs:
  #     sync:
  #       description: "File synchronization"
  #       required: true
  #       default: "delta"
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: "Checkout"
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
    - name: Install Node.js
      uses: actions/setup-node@v3
      with:
        node-version: 16
    - name: Install npm dependencies
      run: npm install
    - name: Run build task
      run: npm run build --if-present
    - name: Remove node mdules
      uses: JesseTG/rm@v1.0.3
      with:
        path: node_modules/
    - name: Remove package
      uses: JesseTG/rm@v1.0.3
      with:
        path: package-lock.json
    # - name: Deploy to Server
    #   uses: easingthemes/ssh-deploy@main
    #   env:
    #     SSH_PRIVATE_KEY: ${{ secrets.PRIVATE_KEY }}
    #     REMOTE_HOST: ${{ secrets.REMOTE_HOST }}
    #     REMOTE_USER: ${{ secrets.SSH_USER }}
    #     TARGET: ${{ secrets.REMOTE_TARGET }}
    #     ARGS: -rlgoDzvc -i 
    #     EXCLUDE: "/dist/, /node_modules/, /.git/, /.github/"
    #     SCRIPT_BEFORE: |
    #       whoami
    #       ls -al
    - name: "Deploy"
      uses: milanmk/actions-file-deployer@master
      with:
        remote-protocol: "sftp"
        remote-host: ${{ secrets.REMOTE_HOST }}
        remote-user: ${{ secrets.SFTP_USER }}
        ssh-private-key: ${{ secrets.PRIVATE_KEY }}
        remote-path: /var/www/uni.is/site/public_html/wp-content/themes/uni-hub